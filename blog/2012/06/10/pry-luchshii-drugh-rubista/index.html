
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Pry - лучший друг Rubista - Demiazz Harbor</title>
  <meta name="author" content="Алексей Плуталов">

  
  <meta name="description" content="Если вы читаете эту статью, то вы вероятно разработчик. Разработчик на Ruby, и возможно вас привлек заголовок статьи. Как часто вы задумываетесь над &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://demiazz.github.com/blog/2012/06/10/pry-luchshii-drugh-rubista">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Demiazz Harbor" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Demiazz Harbor</a></h1>
  
    <h2>Путанные гиковские мысли о веб-разработке, и вообще.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="Подписаться на RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:demiazz.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Поиск"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Блог</a></li>
  <li><a href="/blog/archives">Архив</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Pry - лучший друг Rubista</h1>
    
    
      <p class="meta">
        








  



<time datetime="2012-06-10T20:46:00+04:00" pubdate data-updated="true">Jun 10<span>th</span>, 2012</time>
        
         | <a href="#disqus_thread">Комментарии</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Если вы читаете эту статью, то вы вероятно разработчик. Разработчик на Ruby, и возможно вас привлек заголовок статьи.</p>

<p>Как часто вы задумываетесь над инструментами, с которыми работаете? Как часто думаете, что вам чего-то не хватает, или вас что-то не устраивает? Если не часто - то вы вероятно очень счастливый человек, так как я нахожусь в постоянном поиске идеалов для решения своих задач, которыми я мог бы пользоваться ежедневно, получать удовольствие и не задумываться над тем, что я работаю с ПО, а не выполняю свою работу.</p>

<p>Иногда случается, что для тех или иных задач я нахожу все таки идеал. И хотелось бы рассказать об очень любопытном проекте под названием Pry, который я ежедневно использую. Это интерактивная консоль для Ruby-разработчиков с огромными возможностями. С тех пор как меня с ним познакомили (спасибо за это Алексею Магусеву) я до сих пор нахожусь в вау-эффекте, причем в очень положительном. Ниже я проведу краткий экскурс по этому замечательному инструменту, и очень надеюсь, что вы разделите мое мнение относительно него.</p>

<!-- more -->


<h2>Что за зверь такой этот ваш pry?</h2>

<p>Сейчас я сижу и думаю, как бы правильно охарактеризовать pry, потому что этот инструмент настолько
многограннен, что я затрудняюсь это сделать.</p>

<p>Сами разработчики pry позиционируют свое детище, как альтернативную интерактивную консоль для разработчиков на Ruby, которая призвана заменить IRB. Поставленную цель они выполнили более чем на отлично. Но мое затруднение вызвано тем, что в pry настолько огромное количество самых разных
возможностей, что я не могу относится к нему просто как к интерактивной консоли. Пройдем по порядку,
что умеет pry из коробки, помимо того, чтобы быть просто консолью:</p>

<ul>
<li>просмотр исходного кода (в том числе и на C, но уже включением плагина <code>pry-doc</code>);</li>
<li>навигация по приложению в текущем состоянии;</li>
<li>просмотр исходного кода в Rubinius;</li>
<li>просмотр документации;</li>
<li>&#8220;живая&#8221; система помощи;</li>
<li>редактирование кода на лету;</li>
<li>подсветка синтаксиса;</li>
<li>интеграция с командной оболочкой;</li>
<li>интеграция с Gist;</li>
<li>возможность работы в runtime окружении;</li>
<li>история команд.</li>
</ul>


<p>Pry создавался под влиянием таких инструментов как IPython, Smalltalk, SLIME и в сравнении с IRB выглядит как zsh в сравнении с sh. Разница огромна, а возможности поражают. Честно признаюсь, я хоть и активно пользуюсь pry, но до сих пор не постиг и половины его возможностей, ибо их очень много.</p>

<p>Но тем не менее, хотелось бы не просто пиарить проект копируя примеры из официальной документации, но и рассказать о том, как я ими пользуюсь, так как красивая документация - это ничто по сравнению с опытом использования. Однако, я разделю свое повествования на структуру близкую к официальной документации, чтобы можно было сразу перейти к проекту и посмотреть более расширено то, что там действительно есть.</p>

<h2>Работа с пользовательским вводом</h2>

<p>У вас часто были ситуации, когда вам приходилось писать какие-то функции или большие одноразовые куски кода? К примеру добавить запись в базу данных с большим количеством полей или что-то подобное? В код не вынести, но нужно что-то в консоли проверить.</p>

<p>Иногда у меня встречаются такие ситуации, и&#8230; Бывают моменты, когда очень легко опечататься. Это очень неприятно, так как приходится набирать тот же самый код с нуля, что тратит драгоценное время и тратит еще более драгоценные нервы, так как я не люблю много раз писать одно и тоже.</p>

<p>Видимо мои взгляды такие же, как у разработчиков pry, потому что они очень хорошо позаботились о том, чтобы максимально удобно и просто решить данную проблему. В pry очень удобные инструменты для управления пользовательским вводом.</p>

<p>К примеру набирая код, вдруг думаешь, что нет. Он не нужен. И просто вводом <code>!</code> можно этот ввод очистить. Для наглядности, я все же возьму пример из официальной документации, так как особо вспоминать пример для этого у меня нет желания. Слишком я леним.</p>

<figure class='code'><figcaption><span>Быстрая очистка набираемого текста  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="k">def</span> <span class="nf">hello</span>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span>   <span class="nb">puts</span> <span class="s2">&quot;hello&quot;</span>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span> <span class="o">!</span>
</span><span class='line'><span class="no">Input</span> <span class="n">buffer</span> <span class="n">cleared!</span>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>На этом месте, конечно многие скажут, что отменить ввод можно и в IRB, однако смысл этой команды более глубок, если более детально ознакомиться с функционалом pry, и тогда все встанет на свои места. Я имею ввиду работу с историей и проигрыванием кода.</p>

<p>Все что вы вводите в консоль pry записывается в историю, и это можно воспроизвести. Причем, когда я говорю воспроизвести, я не имею ввиду стандартную навигацию по истории подобно IRB, а именно полноценно воспроизвести определенные куски кода, которые вводились за время сессии. Например:</p>

<figure class='code'><figcaption><span>История ввода и повторное воспроизведение кода  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="nb">puts</span> <span class="s2">&quot;This is first line&quot;</span>
</span><span class='line'><span class="no">This</span> <span class="n">is</span> <span class="n">first</span> <span class="n">line</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kp">nil</span>
</span><span class='line'><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="nb">puts</span> <span class="s2">&quot;This is second line&quot;</span>
</span><span class='line'><span class="no">This</span> <span class="n">is</span> <span class="n">second</span> <span class="n">line</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kp">nil</span>
</span><span class='line'><span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">hist</span> <span class="o">--</span><span class="n">tail</span> <span class="mi">2</span>
</span><span class='line'><span class="mi">1</span><span class="p">:</span> <span class="nb">puts</span> <span class="s2">&quot;This is first line&quot;</span>
</span><span class='line'><span class="mi">2</span><span class="p">:</span> <span class="nb">puts</span> <span class="s2">&quot;This is second line&quot;</span>
</span><span class='line'><span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">hist</span> <span class="o">--</span><span class="n">replay</span> <span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">2</span>
</span><span class='line'><span class="no">This</span> <span class="n">is</span> <span class="n">first</span> <span class="n">line</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kp">nil</span>
</span><span class='line'><span class="no">This</span> <span class="n">is</span> <span class="n">second</span> <span class="n">line</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kp">nil</span>
</span></code></pre></td></tr></table></div></figure>


<p>На самом деле управление историей в pry гораздо более обширно по функционалу и выше я показал лишь очень маленький пример. Для более детального ознакомления прошу <a href="https://github.com/pry/pry/wiki/History">сюда</a>.</p>

<p>Иногда удобно отключить вывод результата выполнения строки кода. Например, мы получили из базы двадцать записей, и итератором each проделали что-то. В общем, отключить вывод можно добавив в конце <code>;</code>:</p>

<figure class='code'><figcaption><span>Отключение вывода результата выполнения  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="nb">puts</span> <span class="s2">&quot;This is first line&quot;</span><span class="p">;</span>
</span><span class='line'><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Как я уже говорил, иногда бывают ситуации, когда мы опечатываемся в наборе кода, и его приходится набирать полностью с нуля (например код какого-то временно используемого метода). Но этого можно избежать, к примеру используя команду <code>amend-line</code>.</p>

<figure class='code'><figcaption><span>Исправление ошибок в набираемом блоке кода  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">14</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="k">def</span> <span class="nf">hello</span>
</span><span class='line'><span class="o">[</span><span class="mi">14</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span>   <span class="nb">puts</span> <span class="s2">&quot;Hello, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span class='line'><span class="o">[</span><span class="mi">14</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span>   <span class="n">amend</span><span class="o">-</span><span class="n">line</span> <span class="mi">1</span> <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="p">:</span> <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'><span class="mi">2</span><span class="p">:</span>   <span class="nb">puts</span> <span class="s2">&quot;Hello, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span class='line'><span class="o">[</span><span class="mi">14</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span>   <span class="k">end</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kp">nil</span>
</span><span class='line'><span class="o">[</span><span class="mi">15</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">show</span><span class="o">-</span><span class="nb">method</span> <span class="n">hello</span>
</span><span class='line'>
</span><span class='line'><span class="no">From</span><span class="p">:</span> <span class="p">(</span><span class="n">pry</span><span class="p">)</span> <span class="err">@</span> <span class="n">line</span> <span class="mi">10</span><span class="p">:</span>
</span><span class='line'><span class="no">Number</span> <span class="n">of</span> <span class="n">lines</span><span class="p">:</span> <span class="mi">3</span>
</span><span class='line'><span class="no">Owner</span><span class="p">:</span> <span class="no">Object</span>
</span><span class='line'><span class="no">Visibility</span><span class="p">:</span> <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;Hello, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="o">[</span><span class="mi">16</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Эта команда позволяет заменить не одну строку, но даже их последовательность или вовсе удалить их, если передать <code>!</code> вместо исправленной строки.</p>

<p>Если набрать кода нужно очень много, то безусловно лучше воспользоваться услугами редактора кода, нежели встроенные(пусть и чертовски продвинутые) средства pry для редактирования кода. И это черт побери возможно!</p>

<figure class='code'><figcaption><span>Редактирование кода в текстовом редакторе  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">17</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="k">def</span> <span class="nf">goodbye</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">surname</span><span class="p">)</span>
</span><span class='line'><span class="o">[</span><span class="mi">17</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span>   <span class="n">full_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">surname</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="o">[</span><span class="mi">17</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span>   <span class="n">edit</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kp">nil</span>
</span><span class='line'><span class="o">[</span><span class="mi">18</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">show</span><span class="o">-</span><span class="nb">method</span> <span class="n">goodbye</span>
</span><span class='line'>
</span><span class='line'><span class="no">From</span><span class="p">:</span> <span class="p">(</span><span class="n">pry</span><span class="p">)</span> <span class="err">@</span> <span class="n">line</span> <span class="mi">14</span><span class="p">:</span>
</span><span class='line'><span class="no">Number</span> <span class="n">of</span> <span class="n">lines</span><span class="p">:</span> <span class="mi">4</span>
</span><span class='line'><span class="no">Owner</span><span class="p">:</span> <span class="no">Object</span>
</span><span class='line'><span class="no">Visibility</span><span class="p">:</span> <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">goodbye</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">surname</span><span class="p">)</span>
</span><span class='line'>  <span class="n">full_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">surname</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;Goodbye, </span><span class="si">#{</span><span class="n">full_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="o">[</span><span class="mi">19</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Возможности редактирования на самом деле еще больше, например можно открыть на редактирование файл с исходным кодом для редактирования к примеру конкретного метода. В общем, читаем <a href="https://github.com/pry/pry/wiki/Editor-Integration">здесь</a>.</p>

<p>Ненадолго хочется вернуться к &#8220;проигрыванию&#8221; кода. Я выше показывал, как можно проигрывать код из истории пользовательского ввода. Но pry позволяет &#8220;проигрывать&#8221; отдельные файлы и методы, и даже отдельные строки методов прямо в поток ввода pry, будто этот код был введен вами. Эдакое подобие макроса получается.</p>

<figure class='code'><figcaption><span>Проигрывание кода методов для формирования нового  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">19</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'><span class="o">[</span><span class="mi">19</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span>   <span class="nb">puts</span> <span class="s2">&quot;Hello, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span class='line'><span class="o">[</span><span class="mi">19</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span> <span class="k">end</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kp">nil</span>
</span><span class='line'><span class="o">[</span><span class="mi">20</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="k">def</span> <span class="nf">goodbye</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'><span class="o">[</span><span class="mi">20</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span>   <span class="nb">puts</span> <span class="s2">&quot;Goodbye, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span class='line'><span class="o">[</span><span class="mi">20</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span> <span class="k">end</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kp">nil</span>
</span><span class='line'><span class="o">[</span><span class="mi">21</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="k">def</span> <span class="nf">hello_and_goodbye</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'><span class="o">[</span><span class="mi">21</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span>   <span class="n">play</span> <span class="o">-</span><span class="n">m</span> <span class="n">hello</span> <span class="o">--</span><span class="n">lines</span> <span class="mi">2</span>
</span><span class='line'><span class="mi">1</span><span class="p">:</span> <span class="k">def</span> <span class="nf">hello_and_goodbye</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'><span class="mi">2</span><span class="p">:</span>   <span class="nb">puts</span> <span class="s2">&quot;Hello, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span class='line'><span class="o">[</span><span class="mi">21</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span>   <span class="n">play</span> <span class="o">-</span><span class="n">m</span> <span class="n">goodbye</span> <span class="o">--</span><span class="n">lines</span> <span class="mi">2</span>
</span><span class='line'><span class="mi">1</span><span class="p">:</span> <span class="k">def</span> <span class="nf">hello_and_goodbye</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'><span class="mi">2</span><span class="p">:</span>   <span class="nb">puts</span> <span class="s2">&quot;Hello, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span class='line'><span class="mi">3</span><span class="p">:</span>   <span class="nb">puts</span> <span class="s2">&quot;Goodbye, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span class='line'><span class="o">[</span><span class="mi">21</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span>   <span class="n">show</span><span class="o">-</span><span class="n">input</span>
</span><span class='line'><span class="mi">1</span><span class="p">:</span> <span class="k">def</span> <span class="nf">hello_and_goodbye</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'><span class="mi">2</span><span class="p">:</span>   <span class="nb">puts</span> <span class="s2">&quot;Hello, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span class='line'><span class="mi">3</span><span class="p">:</span>   <span class="nb">puts</span> <span class="s2">&quot;Goodbye, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span class='line'><span class="o">[</span><span class="mi">21</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span> <span class="k">end</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kp">nil</span>
</span><span class='line'><span class="o">[</span><span class="mi">22</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">show</span><span class="o">-</span><span class="nb">method</span> <span class="n">hello_and_goodbye</span>
</span><span class='line'>
</span><span class='line'><span class="no">From</span><span class="p">:</span> <span class="p">(</span><span class="n">pry</span><span class="p">)</span> <span class="err">@</span> <span class="n">line</span> <span class="mi">24</span><span class="p">:</span>
</span><span class='line'><span class="no">Number</span> <span class="n">of</span> <span class="n">lines</span><span class="p">:</span> <span class="mi">4</span>
</span><span class='line'><span class="no">Owner</span><span class="p">:</span> <span class="no">Object</span>
</span><span class='line'><span class="no">Visibility</span><span class="p">:</span> <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">hello_and_goodbye</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;Hello, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;Goodbye, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Это такой краткий экскурс по быстрой работе с кодом прямо в консоли pry.</p>

<h2>Навигация по контексту исполнения</h2>

<p>Программа на Ruby, похожа на операционную систему. Она состоит их отдельных модулей, которые взаимодействуют между собой, имеют свое внутреннее окружение. Представьте теперь, что эта программа еще и выглядит как файловая система, где каждый объект одновременно выступает в роли и директории, которая содержит другие файлы, и в качестве каталога, и внутри каждого каталога есть свой контекст исполнения, свое окружение. И теперь представьте, что вы можете перемещаться по работающему приложению куда вам вздумается и делать там что угодно, оперировать и изучать живой(!) код прямо в runtime(!).</p>

<p>Наверное программисты на компилируемых языках просто обзавидуются, да и многие другие программисты тоже. Но нам повезло. У нас есть pry, и он делает нашу фантазию реальностью. Такие возможности интересны не только в контексте изучения работы программ изнутри, но и очень помогают при отладке кода, когда в живом работаюшем коде можно посмотреть чтоже происходит, и при каких условиях возникает ошибка и откуда у нее растут ноги.</p>

<p>Ну да бог с ним. Перейдем от кода, ой от слов, к делу и посмотрим как это выглядит.</p>

<p>Предположим, мы создали Rails приложение, запустили консоль c pry. Давайте попробуем исследовать наше приложение изнутри так сказать и посмотреть, что там есть.</p>

<p>Исполняемое приложение, тем более такое сложное как Rails, да еще на динамическом языке типа Ruby - подобно огромной сети пещер, где темно, страшно и ничего не видно. Ну прям как в ж*пе у афроамериканца. А нас посадили где то в центре этой пещеры, и мы как то должны научиться ориентироваться в ней.</p>

<p>Для начала, нам бы понадобился фонарик. Нам нужно оглядеться вокруг, и посмотреть что вокруг собственно есть. Для этого у нас есть команда <code>ls</code>. Не удивляйтесь, так как я не спроста привел в начале этой части аналогию с файловой системой. Эта команда действительно позволяет практически тоже, что и ее аналог из Unix, за оговорками того, с чем мы работаем.</p>

<p>Эта команда позволит нам легко оглядеться, и увидеть что находится в непосредственной близости от нас, или до чего мы сможем дотянутся нашими загребущими рученками.</p>

<figure class='code'><figcaption><span>Смотрим на переменные класса ActiveRecord::Base  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">27</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">):</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'><span class="o">[</span><span class="mi">28</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">):</span><span class="mi">2</span><span class="o">&gt;</span> <span class="n">ls</span> <span class="o">-</span><span class="n">ivars</span>
</span><span class='line'><span class="n">instance</span> <span class="n">variables</span><span class="p">:</span> <span class="vi">@attribute_method_matchers_cache</span>  <span class="vi">@attribute_methods_generated</span>  <span class="vi">@generated_attribute_methods</span>  <span class="vi">@generated_external_attribute_methods</span>  <span class="vi">@observers</span>
</span><span class='line'><span class="k">class</span> <span class="n">variables</span><span class="p">:</span> <span class="vc">@@attribute_types_cached_by_default</span>  <span class="vc">@@configurations</span>  <span class="vc">@@default_timezone</span>  <span class="vc">@@lock_optimistically</span>  <span class="vc">@@logger</span>  <span class="vc">@@primary_key_prefix_type</span>  <span class="vc">@@schema_format</span>  <span class="vc">@@time_zone_aware_attributes</span>  <span class="vc">@@timestamped_migrations</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Ищем методы связанные с callback&#8217;ами  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">):</span><span class="mi">2</span><span class="o">&gt;</span> <span class="n">ls</span> <span class="o">-</span><span class="n">G</span> <span class="n">callbacks</span>
</span><span class='line'><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Callbacks</span><span class="o">::</span><span class="no">ClassMethods</span><span class="c1">#methods: __update_callbacks  define_callbacks  reset_callbacks</span>
</span><span class='line'><span class="no">ActiveModel</span><span class="o">::</span><span class="no">Callbacks</span><span class="c1">#methods: define_model_callbacks</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">methods</span><span class="p">:</span> <span class="n">_commit_callbacks</span>  <span class="n">_commit_callbacks</span><span class="o">=</span>  <span class="n">_commit_callbacks?</span>  <span class="n">_create_callbacks</span>  <span class="n">_create_callbacks</span><span class="o">=</span>  <span class="n">_create_callbacks?</span>  <span class="n">_destroy_callbacks</span>  <span class="n">_destroy_callbacks</span><span class="o">=</span>  <span class="n">_destroy_callbacks?</span>  <span class="n">_find_callbacks</span>  <span class="n">_find_callbacks</span><span class="o">=</span>  <span class="n">_find_callbacks?</span>  <span class="n">_initialize_callbacks</span>  <span class="n">_initialize_callbacks</span><span class="o">=</span>  <span class="n">_initialize_callbacks?</span>  <span class="n">_rollback_callbacks</span>  <span class="n">_rollback_callbacks</span><span class="o">=</span>  <span class="n">_rollback_callbacks?</span>  <span class="n">_save_callbacks</span>  <span class="n">_save_callbacks</span><span class="o">=</span>  <span class="n">_save_callbacks?</span>  <span class="n">_touch_callbacks</span>  <span class="n">_touch_callbacks</span><span class="o">=</span>  <span class="n">_touch_callbacks?</span>  <span class="n">_update_callbacks</span>  <span class="n">_update_callbacks</span><span class="o">=</span>  <span class="n">_update_callbacks?</span>  <span class="n">_validate_callbacks</span>  <span class="n">_validate_callbacks</span><span class="o">=</span>  <span class="n">_validate_callbacks?</span>  <span class="n">_validation_callbacks</span>  <span class="n">_validation_callbacks</span><span class="o">=</span>  <span class="n">_validation_callbacks?</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="c1">#methods: _commit_callbacks  _commit_callbacks=  _commit_callbacks?  _create_callbacks  _create_callbacks=  _create_callbacks?  _destroy_callbacks  _destroy_callbacks=  _destroy_callbacks?  _find_callbacks  _find_callbacks=  _find_callbacks?  _initialize_callbacks  _initialize_callbacks=  _initialize_callbacks?  _rollback_callbacks  _rollback_callbacks=  _rollback_callbacks?  _save_callbacks  _save_callbacks=  _save_callbacks?  _touch_callbacks  _touch_callbacks=  _touch_callbacks?  _update_callbacks  _update_callbacks=  _update_callbacks?  _validate_callbacks  _validate_callbacks=  _validate_callbacks?  _validation_callbacks  _validation_callbacks=  _validation_callbacks?</span>
</span><span class='line'><span class="n">instance</span> <span class="n">variables</span><span class="p">:</span> <span class="vi">@attribute_method_matchers_cache</span>  <span class="vi">@attribute_methods_generated</span>  <span class="vi">@generated_attribute_methods</span>  <span class="vi">@generated_external_attribute_methods</span>  <span class="vi">@observers</span>
</span><span class='line'><span class="k">class</span> <span class="n">variables</span><span class="p">:</span> <span class="vc">@@attribute_types_cached_by_default</span>  <span class="vc">@@configurations</span>  <span class="vc">@@default_timezone</span>  <span class="vc">@@lock_optimistically</span>  <span class="vc">@@logger</span>  <span class="vc">@@primary_key_prefix_type</span>  <span class="vc">@@schema_format</span>  <span class="vc">@@time_zone_aware_attributes</span>  <span class="vc">@@timestamped_migrations</span>
</span></code></pre></td></tr></table></div></figure>


<p>Как вы заметили, я использовал другое приспособление под названием <code>cd</code>. Это такое чудо техники, под названием телепорт, которое помогает мне перемещаться по темному и мрачному лабиринту работающего кода.
Он позволяет перейти в контекст всего, куда можно дотянуться. Например, любая переменная доступная из текущей области видимости.</p>

<figure class='code'><figcaption><span>Путешествие по Rails фреймворку  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">21</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'><span class="o">[</span><span class="mi">22</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">):</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'><span class="o">[</span><span class="mi">23</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span><span class="p">):</span><span class="mi">2</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="no">ActiveSupport</span>
</span><span class='line'><span class="o">[</span><span class="mi">24</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="no">ActiveSupport</span><span class="p">):</span><span class="mi">3</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span>
</span><span class='line'><span class="o">[</span><span class="mi">25</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span><span class="p">):</span><span class="mi">2</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span>
</span><span class='line'><span class="o">[</span><span class="mi">26</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">):</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span>
</span><span class='line'><span class="o">[</span><span class="mi">27</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Путешествуя по дебрям приложения, мы оставляем за собой путеводную нить Ариадны, и следим за вложенностью контекстов, в которых работаем. А также, наш телепорт умеет перемещать нас используя эту самую нить, и мы можем прыгать через контексты.</p>

<figure class='code'><figcaption><span>Просмотр вложенных контекстов  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">27</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'><span class="o">[</span><span class="mi">28</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">):</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'><span class="o">[</span><span class="mi">29</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span><span class="p">):</span><span class="mi">2</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="no">ActiveSupport</span>
</span><span class='line'><span class="o">[</span><span class="mi">30</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="no">ActiveSupport</span><span class="p">):</span><span class="mi">3</span><span class="o">&gt;</span> <span class="n">nesting</span>
</span><span class='line'><span class="no">Nesting</span> <span class="n">status</span><span class="p">:</span>
</span><span class='line'><span class="o">--</span>
</span><span class='line'><span class="mi">0</span><span class="o">.</span> <span class="n">main</span> <span class="p">(</span><span class="no">Pry</span> <span class="n">top</span> <span class="n">level</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="o">.</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'><span class="mi">2</span><span class="o">.</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'><span class="mi">3</span><span class="o">.</span> <span class="no">ActiveSupport</span>
</span><span class='line'><span class="o">[</span><span class="mi">31</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="no">ActiveSupport</span><span class="p">):</span><span class="mi">3</span><span class="o">&gt;</span> <span class="n">jump</span><span class="o">-</span><span class="n">to</span> <span class="mi">1</span>
</span><span class='line'><span class="o">[</span><span class="mi">32</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">):</span><span class="mi">1</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>И прошу не путать вложенные контексты, с областью видимости или наследованием. Это контекст в терминах pry, считайте, что-то вроде сессии. Я не вдавался глубоко в подробности, так что если найдется человек знающий, прошу просвятить меня в комментариях к статье.</p>

<p>Иногда встречаются ситуации, когда нам нужно переключиться между контекстами. К примеру, что-то быстро посмотреть, и вернуться обратно. Это тоже возможно. Здесь я не буду выдумывать свой пример, и возьму пример из официальной документации.</p>

<figure class='code'><figcaption><span>Переключение между контекстами  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">pry</span><span class="p">(</span><span class="no">Pry</span><span class="o">::</span><span class="no">CommandSet</span><span class="o">::</span><span class="no">Command</span><span class="p">):</span><span class="mi">3</span><span class="o">&gt;</span> <span class="k">def</span> <span class="nf">test_method</span>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="no">Pry</span><span class="o">::</span><span class="no">CommandSet</span><span class="o">::</span><span class="no">Command</span><span class="p">):</span><span class="mi">3</span><span class="o">*</span>   <span class="nb">puts</span> <span class="s2">&quot;this is a test&quot;</span>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="no">Pry</span><span class="o">::</span><span class="no">CommandSet</span><span class="o">::</span><span class="no">Command</span><span class="p">):</span><span class="mi">3</span><span class="o">*</span> <span class="n">nesting</span>
</span><span class='line'><span class="no">Nesting</span> <span class="n">status</span><span class="p">:</span>
</span><span class='line'><span class="o">--</span>
</span><span class='line'><span class="mi">0</span><span class="o">.</span> <span class="n">main</span> <span class="p">(</span><span class="no">Pry</span> <span class="n">top</span> <span class="n">level</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="o">.</span> <span class="no">Pry</span>
</span><span class='line'><span class="mi">2</span><span class="o">.</span> <span class="no">Pry</span><span class="o">::</span><span class="no">CommandSet</span>
</span><span class='line'><span class="mi">3</span><span class="o">.</span> <span class="no">Pry</span><span class="o">::</span><span class="no">CommandSet</span><span class="o">::</span><span class="no">Command</span>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="no">Pry</span><span class="o">::</span><span class="no">CommandSet</span><span class="o">::</span><span class="no">Command</span><span class="p">):</span><span class="mi">3</span><span class="o">*</span> <span class="n">switch</span><span class="o">-</span><span class="n">to</span> <span class="mi">2</span>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="no">Pry</span><span class="o">::</span><span class="no">CommandSet</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">ls</span> <span class="o">-</span><span class="n">m</span>
</span><span class='line'><span class="n">allocate</span>  <span class="kp">new</span>  <span class="n">superclass</span>  <span class="n">yaml_tag</span>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="no">Pry</span><span class="o">::</span><span class="no">CommandSet</span><span class="p">)</span><span class="o">&gt;</span> <span class="nb">exit</span>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="no">Pry</span><span class="o">::</span><span class="no">CommandSet</span><span class="o">::</span><span class="no">Command</span><span class="p">):</span><span class="mi">3</span><span class="o">*</span> <span class="n">show</span><span class="o">-</span><span class="n">input</span>
</span><span class='line'><span class="mi">1</span><span class="p">:</span> <span class="k">def</span> <span class="nf">test_method</span>
</span><span class='line'><span class="mi">2</span><span class="p">:</span>   <span class="nb">puts</span> <span class="s2">&quot;this is a test&quot;</span>
</span><span class='line'><span class="n">pry</span><span class="p">(</span><span class="no">Pry</span><span class="o">::</span><span class="no">CommandSet</span><span class="o">::</span><span class="no">Command</span><span class="p">):</span><span class="mi">3</span><span class="o">*</span>
</span></code></pre></td></tr></table></div></figure>


<p>Как видно из примера, <code>switch-to</code> очень похожа на <code>jump-to</code>. Однако есть два больших различия. Каждый из вас работал с командной строкой. Когда мы выполняем команду <code>cd</code> в pry - мы создаем новый контекст (представьте будто это сессия bash, или рабочий стол). Переходя все глубже и глубже вы создаете контексты. Возвращаясь наверх, нижележащие контексты закрываются.</p>

<p>В случае с использованием <code>switch-to</code>, все происходит немного не так. Когда вы вызываете эту команду, то это было бы равносильно тому, что вы работая в терминале, открыли еще один терминал, и полностью передали управление нужным контекстом этому терминалу. Так происходит и в pry. Он не закрывает нижележащий контекст, а создает новый объект <code>Pry</code>, и отдает под его управление нужный контекст.</p>

<p>Помимо навигации, нам порой нужна и поисковая система. К примеру, мы хотим найти метод с названием <code>serialized_attributes</code>.</p>

<figure class='code'><figcaption><span>Поиск метода с заданным именем  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">Apple</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">;</span> <span class="k">end</span>
</span><span class='line'><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">find</span><span class="o">-</span><span class="nb">method</span> <span class="n">serialized_attributes?</span>
</span><span class='line'>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">serialized_attributes?</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">serialized_attributes</span><span class="o">=</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">serialized_attributes</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="c1">#serialized_attributes</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="c1">#serialized_attributes?</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="c1">#serialized_attributes=</span>
</span></code></pre></td></tr></table></div></figure>


<p>В случае Rails приложения - эта операция будет дорогой, так как она будет шерстить все, что есть в приложении. А это очень много кода. Зачастую же, мы уже примерно знаем, где нужно найти нужный метод.</p>

<figure class='code'><figcaption><span>Поиск метода в классе  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">find</span><span class="o">-</span><span class="nb">method</span> <span class="n">serialized_attributes?</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">serialized_attributes?</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">serialized_attributes</span><span class="o">=</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">serialized_attributes</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="c1">#serialized_attributes</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="c1">#serialized_attributes?</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="c1">#serialized_attributes=</span>
</span></code></pre></td></tr></table></div></figure>


<p>Можно также задать вопрос &#8220;Где используется искомый нами метод?&#8221;.</p>

<figure class='code'><figcaption><span>Поиск использования метода по коду  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">5</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="no">Apple</span><span class="p">):</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">find</span><span class="o">-</span><span class="nb">method</span> <span class="o">-</span><span class="n">c</span> <span class="n">serialized_attributes?</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">AttributeMethods</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">AttributeMethods</span><span class="c1">#arel_attributes_values:         value = if klass.serialized_attributes.include?(name)</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">AttributeMethods</span><span class="o">::</span><span class="no">Dirty</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">AttributeMethods</span><span class="o">::</span><span class="no">Dirty</span><span class="c1">#update:     super(changed | (attributes.keys &amp; self.class.serialized_attributes.keys))</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">AttributeMethods</span><span class="o">::</span><span class="no">Serialization</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">AttributeMethods</span><span class="o">::</span><span class="no">Serialization</span><span class="c1">#type_cast_attribute_for_write:   if column &amp;&amp; coder = self.class.serialized_attributes[column.name]</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">AttributeMethods</span><span class="o">::</span><span class="no">Serialization</span><span class="c1">#read_attribute_before_type_cast:   if serialized_attributes.include?(attr_name)</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">AttributeMethods</span><span class="o">::</span><span class="no">Serialization</span><span class="o">::</span><span class="no">ClassMethods</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">AttributeMethods</span><span class="o">::</span><span class="no">Serialization</span><span class="o">::</span><span class="no">ClassMethods</span><span class="c1">#serialize:   self.serialized_attributes = serialized_attributes.merge(attr_name.to_s =&gt; coder)</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">AttributeMethods</span><span class="o">::</span><span class="no">Serialization</span><span class="o">::</span><span class="no">ClassMethods</span><span class="c1">#initialize_attributes:   serialized_attributes.each do |key, coder|</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">AttributeMethods</span><span class="o">::</span><span class="no">Serialization</span><span class="o">::</span><span class="no">ClassMethods</span><span class="c1">#attribute_cast_code:   if serialized_attributes.include?(attr_name)</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Timestamp</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Timestamp</span><span class="c1">#should_record_timestamps?:   self.record_timestamps &amp;&amp; (!partial_updates? || changed? || (attributes.keys &amp; self.class.serialized_attributes.keys).present?)</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Validations</span><span class="o">::</span><span class="no">UniquenessValidator</span>
</span><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Validations</span><span class="o">::</span><span class="no">UniquenessValidator</span><span class="c1">#validate_each:   coder = record.class.serialized_attributes[attribute.to_s]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Когда нам надоест лазать по нашей пещеры, мы можем уйти отсюда, или уйти прихватив с собой сувенир.</p>

<figure class='code'><figcaption><span>Выход из контекста  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Выход из контекста</span>
</span><span class='line'><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="n">p194</span> <span class="p">:</span><span class="mo">013</span> <span class="o">&gt;</span> <span class="n">pry</span>
</span><span class='line'><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="nb">exit</span>
</span><span class='line'> <span class="o">=&gt;</span> <span class="kp">nil</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Выход из контекста с возвращением значения</span>
</span><span class='line'><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="n">p194</span> <span class="p">:</span><span class="mo">014</span> <span class="o">&gt;</span> <span class="n">pry</span>
</span><span class='line'><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="nb">exit</span> <span class="mi">5</span>
</span><span class='line'> <span class="o">=&gt;</span> <span class="mi">5</span>
</span><span class='line'><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="n">p194</span> <span class="p">:</span><span class="mo">015</span> <span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Выход в вызывающий процесс (на примере с возвращаемым значением)</span>
</span><span class='line'><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="n">p194</span> <span class="p">:</span><span class="mo">015</span> <span class="o">&gt;</span> <span class="n">pry</span>
</span><span class='line'><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">):</span><span class="mi">1</span><span class="o">&gt;</span> <span class="nb">exit</span><span class="o">-</span><span class="n">all</span> <span class="s1">&#39;Return to the calling process&#39;</span>
</span><span class='line'> <span class="o">=&gt;</span> <span class="s2">&quot;Return to the calling process&quot;</span>
</span><span class='line'><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="n">p194</span> <span class="p">:</span><span class="mo">016</span> <span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Выход из программы</span>
</span><span class='line'><span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">):</span><span class="mi">1</span><span class="o">&gt;</span> <span class="o">!!!</span>
</span><span class='line'><span class="n">demiazz</span><span class="vi">@demiazz</span><span class="o">-</span><span class="n">laptop</span><span class="ss">:~</span><span class="sr">/repo/</span><span class="n">prye</span><span class="o">-</span><span class="n">example</span><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>Поздравляю, юный падаван. Вы прошли краткий курс выживания в условиях runtime-исполнения приложения написанного на языке программирования Ruby.</p>

<h2>Интеграция с командной строкой операционной системы</h2>

<p>Приложение в runtime никогда не живет само по себе. А в процессе разработки, очень часто требуется иметь доступ к исходному коду, и даже выполнять какие-то команды. В таких случаях, приходится отрываться от текущей сессии, и к примеру открывать отдельный терминал, в котором производить нужные действия.</p>

<p>Но слава богам, разработчики pry умеют заимствовать чужие достижения и перенимать успешные и красивые решения. Не знаю, многие ли из тех, кто читает эти строки, поели в свое время из миски под названием Python, но у меня было счастливое время, когда я писал на этом замечательном языке (причем, все это говорю без сарказма, как многие могут подумать).</p>

<p>Не только Ruby плодотворен на разного рода креативные решения. Среди разработчиков Python есть тоже весьма одаренные люди. И одни из них написали в свое время прекрасную замену системному shell&#8217;у. В отличии от Ruby, Python есть в 99% дистрибутивов из коробки, если не во всех 100%. Это позволяет писать на нем софт, совершенно не беспокоясь, что пользователю Linux системы придется беспокоиться насчет установки интерпретатора языка. В общем, некоторые одаренные личности, скрестили стандартный Python REPL с командной строкой и назвали свое творение IPython. Между прочим, творение прижилось и ничем не уступает даже тому zsh, так как за плечами стоит мощный язык программирования и хороший синтаксис, чего не скажешь ни о каком скриптовом языке для shell.</p>

<p>Так вот, разработчики pry позаимствовали идеи IPython, и внедрили в свой продукт аналогию сего чуда. И получилось весьма и весьма недурственно на мой вкус.</p>

<p>Итак, посмотрим, что мы можем делать? Мы можем работать с pry, будто находимся в shell.</p>

<figure class='code'><figcaption><span>Вызов shell команд из pry  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">.</span><span class="n">ls</span> <span class="o">-</span><span class="n">l</span>
</span><span class='line'><span class="err">итого</span> <span class="mi">80</span>
</span><span class='line'><span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">8</span> <span class="n">demiazz</span> <span class="n">demiazz</span> <span class="mi">4096</span> <span class="err">июня</span>  <span class="mi">10</span> <span class="mo">01</span><span class="p">:</span><span class="mi">37</span> <span class="n">app</span>
</span><span class='line'><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">demiazz</span> <span class="n">demiazz</span>  <span class="mi">213</span> <span class="err">июня</span>  <span class="mi">10</span> <span class="mo">04</span><span class="p">:</span><span class="mi">35</span> <span class="no">Capfile</span>
</span><span class='line'><span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">5</span> <span class="n">demiazz</span> <span class="n">demiazz</span> <span class="mi">4096</span> <span class="err">июня</span>  <span class="mi">10</span> <span class="mi">19</span><span class="p">:</span><span class="mi">26</span> <span class="n">config</span>
</span><span class='line'><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">demiazz</span> <span class="n">demiazz</span>  <span class="mi">157</span> <span class="err">июня</span>  <span class="mi">10</span> <span class="mo">01</span><span class="p">:</span><span class="mi">37</span> <span class="n">config</span><span class="o">.</span><span class="n">ru</span>
</span><span class='line'><span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">demiazz</span> <span class="n">demiazz</span> <span class="mi">4096</span> <span class="err">июня</span>  <span class="mi">10</span> <span class="mi">17</span><span class="p">:</span><span class="mi">49</span> <span class="n">db</span>
</span><span class='line'><span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">demiazz</span> <span class="n">demiazz</span> <span class="mi">4096</span> <span class="err">июня</span>  <span class="mi">10</span> <span class="mo">01</span><span class="p">:</span><span class="mi">37</span> <span class="n">doc</span>
</span><span class='line'><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">demiazz</span> <span class="n">demiazz</span>  <span class="mi">660</span> <span class="err">июня</span>  <span class="mi">10</span> <span class="mi">20</span><span class="p">:</span><span class="mo">07</span> <span class="no">Gemfile</span>
</span><span class='line'><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">demiazz</span> <span class="n">demiazz</span> <span class="mi">4198</span> <span class="err">июня</span>  <span class="mi">10</span> <span class="mi">20</span><span class="p">:</span><span class="mi">09</span> <span class="no">Gemfile</span><span class="o">.</span><span class="n">lock</span>
</span><span class='line'><span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">5</span> <span class="n">demiazz</span> <span class="n">demiazz</span> <span class="mi">4096</span> <span class="err">июня</span>  <span class="mi">10</span> <span class="mi">19</span><span class="p">:</span><span class="mi">15</span> <span class="n">lib</span>
</span><span class='line'><span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">demiazz</span> <span class="n">demiazz</span> <span class="mi">4096</span> <span class="err">июня</span>  <span class="mi">10</span> <span class="mi">15</span><span class="p">:</span><span class="mi">49</span> <span class="n">log</span>
</span><span class='line'><span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">demiazz</span> <span class="n">demiazz</span> <span class="mi">4096</span> <span class="err">июня</span>  <span class="mi">10</span> <span class="mi">19</span><span class="p">:</span><span class="mi">27</span> <span class="kp">public</span>
</span><span class='line'><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">demiazz</span> <span class="n">demiazz</span>  <span class="mi">272</span> <span class="err">июня</span>  <span class="mi">10</span> <span class="mo">01</span><span class="p">:</span><span class="mi">37</span> <span class="no">Rakefile</span>
</span><span class='line'><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">demiazz</span> <span class="n">demiazz</span> <span class="mi">9208</span> <span class="err">июня</span>  <span class="mi">10</span> <span class="mo">01</span><span class="p">:</span><span class="mi">37</span> <span class="no">README</span><span class="o">.</span><span class="n">rdoc</span>
</span><span class='line'><span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">demiazz</span> <span class="n">demiazz</span> <span class="mi">4096</span> <span class="err">июня</span>  <span class="mi">10</span> <span class="mo">01</span><span class="p">:</span><span class="mi">37</span> <span class="n">script</span>
</span><span class='line'><span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">demiazz</span> <span class="n">demiazz</span> <span class="mi">4096</span> <span class="err">июня</span>  <span class="mi">10</span> <span class="mi">20</span><span class="p">:</span><span class="mi">16</span> <span class="n">spec</span>
</span><span class='line'><span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">6</span> <span class="n">demiazz</span> <span class="n">demiazz</span> <span class="mi">4096</span> <span class="err">июня</span>  <span class="mi">10</span> <span class="mi">16</span><span class="p">:</span><span class="mi">08</span> <span class="n">tmp</span>
</span><span class='line'><span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">4</span> <span class="n">demiazz</span> <span class="n">demiazz</span> <span class="mi">4096</span> <span class="err">июня</span>  <span class="mi">10</span> <span class="mo">01</span><span class="p">:</span><span class="mi">37</span> <span class="n">vendor</span>
</span><span class='line'><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;Rakefile&#39;</span>
</span><span class='line'><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">.</span><span class="n">cat</span> <span class="c1">#{filename}</span>
</span><span class='line'><span class="c1">#!/usr/bin/env rake</span>
</span><span class='line'><span class="c1"># Add your own tasks in files placed in lib/tasks ending in .rake,</span>
</span><span class='line'><span class="c1"># for example lib/tasks/capistrano.rake, and they will automatically be available to Rake.</span>
</span><span class='line'>
</span><span class='line'><span class="nb">require</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../config/application&#39;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="no">Scoping</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">load_tasks</span>
</span></code></pre></td></tr></table></div></figure>


<p>Заманчиво, неправда ли. Насколько можно заметить, можно использовать интерполяцию Ruby строк прямо в вызовах команд. Неплохая замена shell&#8217;у получается, надо сказать. У pry есть также <code>shell-mode</code>. По сути, в <code>shell-mode</code> меняется строка приглашения.</p>

<p>Небольшим недостатком является то, что в pry не работает автодополнение к примеру для перехода по каталогам.</p>

<p>Еще у pry имеются две интересные команды <code>cat</code> и <code>cd-gem</code>.</p>

<p>Команда <code>cat</code> умеет выводить различные данные, как и ее родственница из Unix, но ориентированна на работу с кодом и pry. К примеру, она поддерживает подстветку синтаксиса. Но если вам нужна именно настоящая <code>cat</code>, то из pry ее можно вызвать как <code>.cat</code>.</p>

<p>Вторая команда умеет вас быстро перебрасывать в каталог выбранного гема.</p>

<p>Это в принципе база, которой должно с головой хватить для работы с shell из pry, если пригляделся такой вариант.</p>

<h2>Просмотр кода и документации</h2>

<p>Pry в первую очередь интерактивная консоль для разработчиков. Важным моментом здесь является быстрый доступ к исходному коду и документации, и желательно это делать не отрываясь от работы с консолью, без переключения контекста нашего внимания к примеру в браузер, или не дай бог в другой терминал с запущенной ri.</p>

<p>Я это понимаю, вы это понимаете, и главное это понимают разработчики pry.</p>

<p>Для просмотра исходного кода есть специальная команда <code>show-source</code>, которая позволяет просмотреть исходный код метода, или класса. Она также поддерживает синтаксис ri. Также следует заметить, что если у вас уставовлен и загружен плагин &#8216;pry-doc&#8217;, то становится возможным также и просмотр исходного кода на C в случае, если у вас MRI.</p>

<p>Если вы разрабатываете расширения для pry, или вас интересует код команды, то можно воспользоваться командой <code>show-command</code>.</p>

<p>Касательно документации, то есть команда <code>show-doc</code>. Имеется доступ к <code>ri</code> одноименной командой. А также можно посмотреть краткую статистику объекта с помощью <code>stat</code>.</p>

<h2>Использование в качестве отладчика</h2>

<p>Pry можно использовать в качестве отладчика. Причем очень отменного и удобного. В любом месте вашего кода вы можете поставить брекпоинт в виде <code>binding.pry</code>, и при выполнении этого кода, выполнение остановится и откроется сессия Pry с runtime-окружением в момент останова. При выходе из сессии, исполнение кода продолжится дальше с учетом внесенных изменений, если таковые были.</p>

<p>Также не стоит забывать про <code>bundle open &lt;gem-name&gt;</code>. Это позволяет делать более глубокую отладку кода, позволяя делать точки останова и изучать состояние приложения внутри сторонних гемов, а не только внутри нашего приложения.</p>

<p>Это основные и главные для меня фичи, которые я использую регулярно. Если у меня падает код в приложении, и мне надо найти причину падения, если она не видна и не лежит на поверхности, то первым делом я делаю <code>binging.pry</code> и воспроизвожу действие, которое приводит к падению, и изучаю то, что может вызвать ошибку. А учитывая, что я получаю не просто отладчик, а runtime окружение и мощнейшую консоль разработчика с возможность работы с кодом, документацией и многими другими плюшками - то мне не нужны другие инструменты отладки приложения, кроме логов, которые по большей части используются не для попытки узнать что происходит путем топорного <code>puts</code>, а для анализа работы приложения и сохранения данных о работе приложения в production. То есть, логи у меня выполняют ровно ту роль, которую должны выполнять, не более и не менее. Для всего остального есть pry.</p>

<p>Среди всего прочего, многим может прийтись по душе набор доступных расширений, комбинации которых предоставляют и полноценную альтернативу настоящему отладчику, и возможности асинхронной среды (EventMachine), и возможность подсветки синтаксиса вводимого кода, и даже возможности удаленного подключения к отлаживаемому приложению, в том числе и по SSH.</p>

<h2>В заключении</h2>

<p>Статья получилась громоздкой, и я не смог нормально избавиться от дублирования документации по Pry, но постарался сделать так, чтобы хотя бы заинтересовать в том, чтобы пользоваться этим инструментом.</p>

<p>Всю остальную информацию в достатке можно найти по ссылкам ниже:</p>

<ul>
<li><a href="http://pry.github.com/">Официальный сайт</a></li>
<li><a href="https://github.com/pry/pry">Страница на Github</a></li>
<li><a href="https://github.com/pry/pry/wiki">Официальная wiki проекта</a></li>
<li><a href="http://vimeo.com/26391171">Вводный скринкаст от разработчика</a></li>
<li><a href="http://rdoc.info/github/pry/pry/master/file/README.markdown">Документация по API</a></li>
<li><a href="https://github.com/pry/pry/wiki/Available-plugins">Список доступных плагинов</a></li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Опубликовано <span class="fn">Алексей Плуталов</span></span>

      








  



<time datetime="2012-06-10T20:46:00+04:00" pubdate data-updated="true">Jun 10<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/debug/'>debug</a>, <a class='category' href='/blog/categories/pry/'>pry</a>, <a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://demiazz.github.com/blog/2012/06/10/pry-luchshii-drugh-rubista/" data-via="demiazz" data-counturl="http://demiazz.github.com/blog/2012/06/10/pry-luchshii-drugh-rubista/" >Твит</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/06/10/shared-git-riepozitorii/" title="Предыдущий пост: Shared Git-репозитории">&laquo; Shared Git-репозитории</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Комментарии</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Последние записи</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/06/10/pry-luchshii-drugh-rubista/">Pry - лучший друг Rubista</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/10/shared-git-riepozitorii/">Shared Git-репозитории</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/12/04/html5-ispolzovaniie-notification-api-chrome/">HTML5: Использование Notification API (Chrome)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/12/01/kratkii-otchiet-s-html5-camp/">Краткий отчет с HTML5 Camp</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/19/a-successfull-git-branching-model/">A successfull Git branching model</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Последние твиты</h1>
  <ul id="tweets">
    <li class="loading">Обновление статуса...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("demiazz", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/demiazz" class="twitter-follow-button" data-width="208px" data-show-count="true">Читать @demiazz</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/115827334836103106481?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Алексей Плуталов -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'demiazzharbor';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://demiazz.github.com/blog/2012/06/10/pry-luchshii-drugh-rubista/';
        var disqus_url = 'http://demiazz.github.com/blog/2012/06/10/pry-luchshii-drugh-rubista/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
